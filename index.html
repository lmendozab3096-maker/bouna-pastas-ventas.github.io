<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Buona Pasta | Registro de Venta</title>

<style>
body{margin:0;background:#121212;color:#fff;font-family:system-ui}
.wrap{min-height:100vh;display:flex;justify-content:center;align-items:center}
.card{background:#f9f9f9;color:#121212;width:900px;max-width:95%;padding:20px;border-radius:16px}
.grid{display:grid;grid-template-columns:1fr 320px;gap:20px}
select{width:100%;padding:10px;margin-top:6px}
button{padding:10px 14px;border-radius:10px;border:none;font-weight:700;cursor:pointer}
.primary{background:#F4A300}
.summary{background:#121212;color:#fff;padding:14px;border-radius:12px}
.line{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px dashed #333}
.total{display:flex;justify-content:space-between;font-size:18px;margin-top:10px}
.toppings{display:flex;flex-wrap:wrap;gap:8px}
.chip{background:#fff;border:1px solid #ccc;padding:6px 10px;border-radius:10px}
</style>
</head>

<body>

<div class="wrap">
<div class="card">

<h2>Buona Pasta ‚Äì Registro de venta</h2>

<div class="grid">

<div>
<label>Salsa *</label>
<select id="salsa"><option value="">Seleccione</option></select>

<label>Prote√≠na *</label>
<select id="proteina"><option value="">Seleccione</option></select>

<label>Toppings</label>
<div id="toppings" class="toppings"></div>

<label>Acompa√±amiento</label>
<select id="acomp"><option value="">Ninguno</option></select>

<label>Postre</label>
<select id="postre"><option value="">Ninguno</option></select>

<label>Gaseosa</label>
<select id="gaseosa"><option value="">Ninguna</option></select>

<br><br>
<button id="sendBtn" class="primary">Registrar venta</button>
</div>

<div class="summary">
<div id="lista"></div>
<div class="total">
<span>Total</span>
<b id="total">$0</b>
</div>
</div>

</div>
</div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

console.log("JS CARGADO CORRECTAMENTE");

const menu = {
Salsas:{Pomodoro:6000,Alfredo:6000,"3 quesos":8500,Pesto:6000,Carbonara:12500,"A la mantequilla":6000,Bolo√±esa:13000},
Proteinas:{"Pechuga a la plancha":9000,"Jam√≥n de cerdo":8500,Camarones:10000,"Lomo asado":10500,"Mix de mariscos":9500},
Toppings:{Champi√±ones:5000,"Cebolla morada":3000,"Extra parmesano":4000,"Ma√≠z dulce":4500,Albahaca:4500,Espinaca:4000,"Extra mozzarella":5500},
Acompa√±amientos:{"Bruschetta pesto":3500,"Bruschetta pizzera":5000},
Postres:{"Galleta de chocolate":3500,Tiramis√∫:5500},
Gaseosas:{"Coca cola":2500,Colombiana:2000,"Coca cola 0":2500,Manzana:4400,Quatro:3500,"Agua cristal":1500,"Pony malta":3500,Pepsi:2000}
};

const $ = id => document.getElementById(id);
const money = n => n.toLocaleString('es-CO',{style:'currency',currency:'COP',maximumFractionDigits:0});

function fill(select,data){
Object.keys(data).forEach(k=>{
select.innerHTML += `<option value="${k}">${k} - ${money(data[k])}</option>`;
});
}

fill(salsa,menu.Salsas);
fill(proteina,menu.Proteinas);
fill(acomp,menu.Acompa√±amientos);
fill(postre,menu.Postres);
fill(gaseosa,menu.Gaseosas);

Object.keys(menu.Toppings).forEach(k=>{
toppings.innerHTML += `<label class="chip"><input type="checkbox" value="${k}"> ${k}</label>`;
});

sendBtn.addEventListener("click", async () => {
  console.log("BOT√ìN PRESIONADO");

  if (!salsa.value || !proteina.value) {
    alert("Selecciona salsa y prote√≠na");
    return;
  }

  let totalVenta = 0;
  lista.innerHTML = "";
  const items = [];

  const add = (nombre, precio, categoria) => {
    lista.innerHTML += `
      <div class="line">
        <span>${nombre}</span>
        <span>${money(precio)}</span>
      </div>`;
    totalVenta += precio;
    items.push({
      producto: nombre,
      precio: precio,
      categoria: categoria
    });
  }; 

 resetBtn.addEventListener("click", () => {

  // Reset selects
  salsa.value = "";
  proteina.value = "";
  acomp.value = "";
  postre.value = "";
  gaseosa.value = "";

  // Reset toppings
  document
    .querySelectorAll('#toppings input[type="checkbox"]')
    .forEach(c => c.checked = false);

  // Reset resumen
  lista.innerHTML = "";
  total.textContent = money(0);
});


  // Obligatorios
  add(salsa.value, menu.Salsas[salsa.value], "Salsa");
  add(proteina.value, menu.Proteinas[proteina.value], "Prote√≠na");

  // Toppings
  document.querySelectorAll('#toppings input:checked')
    .forEach(c => add(c.value, menu.Toppings[c.value], "Topping"));

  // Opcionales
  if (acomp.value) add(acomp.value, menu.Acompa√±amientos[acomp.value], "Acompa√±amiento");
  if (postre.value) add(postre.value, menu.Postres[postre.value], "Postre");
  if (gaseosa.value) add(gaseosa.value, menu.Gaseosas[gaseosa.value], "Gaseosa");

  total.textContent = money(totalVenta);

  // üîó Payload para Make
  const payload = {
    fecha: new Date().toISOString(),
    total: totalVenta,
    items: items
  };

  console.log("ENVIANDO A MAKE:", payload);

  try {
    const response = await fetch("https://hook.make.com/https://hook.us2.make.com/5a5wu2jmk22svzmiqmmk20ed28y2f8m0", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    if (!response.ok) throw new Error("Error HTTP");

    alert("Venta registrada correctamente ‚úÖ");

  } catch (error) {
    console.error(error);
    alert("Error enviando la venta a Make ‚ùå");
  }
});


add(salsa.value,menu.Salsas[salsa.value]);
add(proteina.value,menu.Proteinas[proteina.value]);

document.querySelectorAll('#toppings input:checked')
.forEach(c=>add(c.value,menu.Toppings[c.value]));

if(acomp.value) add(acomp.value,menu.Acompa√±amientos[acomp.value]);
if(postre.value) add(postre.value,menu.Postres[postre.value]);
if(gaseosa.value) add(gaseosa.value,menu.Gaseosas[gaseosa.value]);

total.textContent = money(totalVenta);

console.log("VENTA REGISTRADA CORRECTAMENTE");
});

});
</script>

</body>
</html>
